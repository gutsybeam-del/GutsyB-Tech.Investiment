<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal | Great Achiever International College</title>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <style>
        :root { --primary: #800000; --secondary: #001f3f; --accent: #daa520; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--light); margin: 0; padding-bottom: 50px; }
        
        /* Layout */
        header { background: var(--primary); color: white; padding: 30px; text-align: center; border-bottom: 5px solid var(--accent); }
        nav { background: var(--secondary); padding: 10px; display: flex; justify-content: center; gap: 20px; }
        nav a { color: white; text-decoration: none; font-weight: bold; cursor: pointer; }
        .container { max-width: 1100px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 5px solid var(--primary); }
        .screen { display: none; }
        .active { display: block; }

        /* Forms */
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .btn { padding: 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .btn-main { background: var(--primary); color: white; }
        .btn-admin { background: var(--secondary); color: white; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 14px; }
        th { background: #eee; }
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; }
        .paid { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

<header>
    <h1>Great Achiever International College</h1>
    <p>Student Management Information System</p>
</header>

<nav>
    <a onclick="showScreen('student-login')">Student Login</a>
    <a onclick="showScreen('admin-login')">Admin Portal</a>
</nav>

<div class="container">

    <div id="student-login" class="screen active card">
        <h2>Student Access</h2>
        <input type="text" id="login-id" placeholder="Admission Number">
        <input type="password" id="login-pass" placeholder="Password">
        <button class="btn btn-main" onclick="handleStudentLogin()">Login</button>
    </div>

    <div id="admin-login" class="screen card">
        <h2>Admin Login</h2>
        <input type="password" id="admin-key" placeholder="Enter Master Key">
        <button class="btn btn-admin" onclick="handleAdminLogin()">Verify Staff</button>
    </div>

    <div id="admin-panel" class="screen">
        <div class="card">
            <h3>1. Enroll New Student</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="text" id="reg-name" placeholder="Full Name">
                <input type="text" id="reg-id" placeholder="Admission Number">
                <select id="reg-class">
                    <option value="JSS">Junior Secondary (₦50k)</option>
                    <option value="SSS_SCIENCE">Senior Science (₦80k)</option>
                    <option value="SSS_ART">Senior Art/Comm (₦70k)</option>
                </select>
                <input type="text" id="reg-pass" placeholder="Set Default Password" value="1234">
            </div>
            <button class="btn btn-main" onclick="registerStudent()">Register Student</button>
        </div>

        <div class="card">
            <h3>2. Input Academic Results</h3>
            <select id="res-student-select"><option>Select Student</option></select>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                <input type="number" id="res-math" placeholder="Math Score">
                <input type="number" id="res-eng" placeholder="English Score">
                <input type="number" id="res-sci" placeholder="Science Score">
            </div>
            <button class="btn btn-admin" onclick="uploadResult()">Upload Result</button>
        </div>

        <div class="card" style="overflow-x:auto;">
            <h3>3. Student Directory</h3>
            <table id="admin-table">
                <thead><tr><th>Name</th><th>ID</th><th>Password</th><th>Fees</th><th>Result</th></tr></thead>
                <tbody id="admin-list"></tbody>
            </table>
            <button class="btn" style="background:#dc3545; color:white; width:auto;" onclick="clearAllData()">Clear All Records (Reset)</button>
        </div>
    </div>

    <div id="student-dash" class="screen">
        <div class="card" style="background:var(--secondary); color:white;">
            <h2 id="s-welcome">Welcome</h2>
            <p>Admission No: <span id="s-id"></span></p>
        </div>

        <div class="card">
            <h3>Change Password</h3>
            <input type="password" id="new-pass" placeholder="Enter New Password">
            <button class="btn btn-admin" onclick="changePassword()">Update Password</button>
        </div>

        <div class="card">
            <h3>Academic Report Card</h3>
            <table>
                <tr><th>Subject</th><th>Score</th><th>Grade</th></tr>
                <tr><td>Mathematics</td><td id="s-math">-</td><td id="g-math">-</td></tr>
                <tr><td>English</td><td id="s-eng">-</td><td id="g-eng">-</td></tr>
                <tr><td>Basic Science</td><td id="s-sci">-</td><td id="g-sci">-</td></tr>
            </table>
        </div>

        <div class="card">
            <h3>Fee Status: <span id="s-fee-status">Pending</span></h3>
            <button class="btn btn-main" id="pay-btn" onclick="payFees()">Pay Now (₦<span id="s-amt"></span>)</button>
        </div>
    </div>
</div>

<script>
    // --- PERSISTENT DATA LOGIC ---
    let students = JSON.parse(localStorage.getItem('GAIC_STUDENTS')) || [];
    let currentStudent = null;

    function saveToStorage() {
        localStorage.setItem('GAIC_STUDENTS', JSON.stringify(students));
    }

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    // --- ADMIN ACTIONS ---
    function handleAdminLogin() {
        if(document.getElementById('admin-key').value === "admin777") {
            updateAdminUI();
            showScreen('admin-panel');
        } else { alert("Wrong Access Key!"); }
    }

    function registerStudent() {
        const name = document.getElementById('reg-name').value;
        const id = document.getElementById('reg-id').value;
        const cls = document.getElementById('reg-class').value;
        const pass = document.getElementById('reg-pass').value;

        if(!name || !id) return alert("Fill all fields");
        
        let fee = (cls === 'JSS') ? 50000 : (cls === 'SSS_SCIENCE' ? 80000 : 70000);
        
        const student = { 
            name, id, cls, pass, fee, 
            paid: false, 
            results: { math: '-', eng: '-', sci: '-' } 
        };
        
        students.push(student);
        saveToStorage();
        updateAdminUI();
        alert("Registered!");
    }

    function uploadResult() {
        const id = document.getElementById('res-student-select').value;
        const student = students.find(s => s.id === id);
        if(!student) return alert("Select student first");

        student.results.math = document.getElementById('res-math').value || '-';
        student.results.eng = document.getElementById('res-eng').value || '-';
        student.results.sci = document.getElementById('res-sci').value || '-';

        saveToStorage();
        updateAdminUI();
        alert("Results Uploaded!");
    }

    function updateAdminUI() {
        const list = document.getElementById('admin-list');
        const select = document.getElementById('res-student-select');
        list.innerHTML = "";
        select.innerHTML = "<option>Select Student</option>";

        students.forEach(s => {
            list.innerHTML += `<tr>
                <td>${s.name}</td>
                <td>${s.id}</td>
                <td>${s.pass}</td>
                <td><span class="badge ${s.paid ? 'paid' : ''}">${s.paid ? 'PAID' : 'OWING'}</span></td>
                <td>M:${s.results.math} E:${s.results.eng}</td>
            </tr>`;
            select.innerHTML += `<option value="${s.id}">${s.name} (${s.id})</option>`;
        });
    }

    // --- STUDENT ACTIONS ---
    function handleStudentLogin() {
        const id = document.getElementById('login-id').value;
        const pass = document.getElementById('login-pass').value;
        const found = students.find(s => s.id === id && s.pass === pass);

        if(found) {
            currentStudent = found;
            loadStudentDash();
            showScreen('student-dash');
        } else { alert("Invalid Credentials!"); }
    }

    function loadStudentDash() {
        document.getElementById('s-welcome').innerText = "Welcome, " + currentStudent.name;
        document.getElementById('s-id').innerText = currentStudent.id;
        document.getElementById('s-amt').innerText = currentStudent.fee.toLocaleString();
        
        // Results
        document.getElementById('s-math').innerText = currentStudent.results.math;
        document.getElementById('s-eng').innerText = currentStudent.results.eng;
        document.getElementById('s-sci').innerText = currentStudent.results.sci;

        if(currentStudent.paid) {
            document.getElementById('s-fee-status').innerText = "PAID ✅";
            document.getElementById('pay-btn').style.display = "none";
        }
    }

    function changePassword() {
        const newPass = document.getElementById('new-pass').value;
        if(newPass.length < 4) return alert("Password too short");
        currentStudent.pass = newPass;
        saveToStorage();
        alert("Password Changed Successfully!");
    }

    function clearAllData() {
        if(confirm("Erase all students?")) {
            localStorage.removeItem('GAIC_STUDENTS');
            location.reload();
        }
    }

    function payFees() {
        FlutterwaveCheckout({
            public_key: "FLWPUBK_TEST-YOUR-KEY-HERE",
            tx_ref: "GAIC-" + Date.now(),
            amount: currentStudent.fee,
            currency: "NGN",
            customer: { email: "student@school.com", name: currentStudent.name },
            callback: function (data) {
                if (data.status === "successful") {
                    currentStudent.paid = true;
                    saveToStorage();
                    loadStudentDash();
                    alert("Payment Successful!");
                }
            }
        });
    }
</script>
</body>
</html>
