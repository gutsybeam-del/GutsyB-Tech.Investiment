<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Achiever Portal | Direct Upload Version</title>
    <script src="https://checkout.flutterwave.com/v3.js"></script>
    <style>
        :root { --primary: #800000; --navy: #001f3f; --gold: #daa520; --light: #f8f9fa; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; display: flex; flex-direction: column; height: 100vh; }

        header { background: var(--primary); color: white; padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--gold); }
        .wrapper { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: #1a1a1a; color: white; display: none; flex-direction: column; padding: 20px 0; }
        .sidebar a { padding: 15px 25px; color: #ccc; text-decoration: none; display: block; cursor: pointer; border-left: 4px solid transparent; }
        .sidebar a:hover { background: #333; color: white; border-left-color: var(--gold); }

        /* Content */
        .content { flex: 1; padding: 25px; overflow-y: auto; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border-top: 5px solid var(--primary); }
        .screen { display: none; }
        .active-screen { display: block; animation: fadeIn 0.4s ease; }

        /* Image Styling */
        .profile-img { width: 120px; height: 120px; border-radius: 50%; border: 3px solid var(--gold); object-fit: cover; display: block; margin: 10px auto; background: #eee; }
        
        input, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; margin-top: 10px; }
        .btn-main { background: var(--primary); color: white; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div style="font-weight: 800;">GREAT ACHIEVER COLLEGE</div>
    <div id="user-display" style="font-size: 12px;">Welcome, Guest</div>
</header>

<div class="wrapper">
    <div class="sidebar" id="sidebar">
        <a onclick="showScreen('s-home')">üè† Dashboard</a>
        <a onclick="showScreen('s-results')">üìä Results</a>
        <a onclick="showScreen('s-fees')">üí≥ Payments</a>
        <a onclick="showScreen('s-profile')">üë§ My Passport</a>
        <a onclick="location.reload()" style="color:red;">Logout</a>
    </div>

    <div class="content">
        <div id="login-screen" class="screen active-screen card" style="max-width: 400px; margin: auto;">
            <h2 style="text-align:center;">Student Login</h2>
            <input type="text" id="l-id" placeholder="Admission Number">
            <input type="password" id="l-pass" placeholder="Password">
            <button class="btn btn-main" onclick="doLogin()">Login</button>
            <p onclick="adminGate()" style="text-align:center; font-size:11px; cursor:pointer; color:gray; margin-top:15px;">Staff Portal</p>
        </div>

        <div id="admin-screen" class="screen card">
            <h2>Admin: Enroll Student</h2>
            <input type="text" id="r-name" placeholder="Full Name">
            <input type="text" id="r-id" placeholder="Admission ID">
            <select id="r-class"><option value="50000">JSS (50k)</option><option value="80000">SSS Sci (80k)</option></select>
            <button class="btn btn-main" onclick="enroll()">Register Student</button>
            <hr>
            <h3>Manage Results</h3>
            <select id="adm-sel"></select>
            <input type="number" id="adm-m" placeholder="Maths Score">
            <input type="number" id="adm-e" placeholder="English Score">
            <button class="btn btn-main" onclick="saveRes()">Upload Scores</button>
        </div>

        <div id="s-home" class="screen card" style="text-align:center;">
            <img src="" id="h-img" class="profile-img" alt="Passport">
            <h2 id="h-name">Student Name</h2>
            <p id="h-id">ID: 000</p>
            <div style="background:#fff3cd; padding:15px; border-radius:10px; margin-top:20px;">
                <p>Click below to verify your account status for the term.</p>
                <button class="btn btn-main" onclick="window.open('https://shrinkme.io/your_id')">Verify Account (Sponsored)</button>
            </div>
        </div>

        <div id="s-profile" class="screen card">
            <h3>Update Your Passport Photograph</h3>
            <div style="text-align: center;">
                <img src="" id="p-preview" class="profile-img" alt="Preview">
            </div>
            <label>Select Image from Gallery:</label>
            <input type="file" id="file-input" accept="image/*" onchange="previewImage()">
            <button class="btn btn-main" onclick="uploadPassport()">Save Passport to Portal</button>
        </div>

        <div id="s-results" class="screen card">
            <h3>Termly Results</h3>
            <table width="100%" border="1" style="border-collapse:collapse;">
                <tr style="background:#eee;"><th>Subject</th><th>Score</th></tr>
                <tr><td>Mathematics</td><td id="v-m">-</td></tr>
                <tr><td>English</td><td id="v-e">-</td></tr>
            </table>
        </div>

        <div id="s-fees" class="screen card">
            <h3>School Fees</h3>
            <p>Balance: <strong id="v-fee">‚Ç¶0.00</strong></p>
            <div id="v-stat" style="padding:5px; display:inline-block; border-radius:4px;"></div><br><br>
            <button class="btn btn-main" id="pay-btn" onclick="pay()">Pay via Flutterwave</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('GAIC_DB')) || [];
    let user = null;
    let tempImg = "";

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
        document.getElementById(id).classList.add('active-screen');
    }

    function adminGate() {
        if(prompt("Key:") === "777") {
            const sel = document.getElementById('adm-sel');
            sel.innerHTML = db.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
            showScreen('admin-screen');
        }
    }

    function enroll() {
        db.push({
            name: document.getElementById('r-name').value,
            id: document.getElementById('r-id').value,
            pass: "1234",
            fee: document.getElementById('r-class').value,
            paid: false,
            img: "",
            math: "-", eng: "-"
        });
        localStorage.setItem('GAIC_DB', JSON.stringify(db));
        alert("Enrolled!");
    }

    function saveRes() {
        let s = db.find(x => x.id === document.getElementById('adm-sel').value);
        s.math = document.getElementById('adm-m').value;
        s.eng = document.getElementById('adm-e').value;
        localStorage.setItem('GAIC_DB', JSON.stringify(db));
        alert("Result Saved!");
    }

    function doLogin() {
        user = db.find(x => x.id === document.getElementById('l-id').value && x.pass === document.getElementById('l-pass').value);
        if(user) {
            document.getElementById('sidebar').style.display = 'flex';
            document.getElementById('user-display').innerText = user.name;
            refreshData();
            showScreen('s-home');
        } else { alert("Wrong ID/Pass"); }
    }

    function refreshData() {
        document.getElementById('h-name').innerText = user.name;
        document.getElementById('h-id').innerText = "ID: " + user.id;
        document.getElementById('h-img').src = user.img || "https://via.placeholder.com/120";
        document.getElementById('p-preview').src = user.img || "https://via.placeholder.com/120";
        document.getElementById('v-m').innerText = user.math;
        document.getElementById('v-e').innerText = user.eng;
        document.getElementById('v-fee').innerText = "‚Ç¶" + parseInt(user.fee).toLocaleString();
        document.getElementById('v-stat').innerText = user.paid ? "PAID" : "UNPAID";
        document.getElementById('v-stat').style.background = user.paid ? "#d4edda" : "#f8d7da";
        document.getElementById('pay-btn').style.display = user.paid ? 'none' : 'block';
    }

    // --- REAL IMAGE UPLOAD LOGIC ---
    function previewImage() {
        const file = document.getElementById('file-input').files[0];
        const reader = new FileReader();
        reader.onloadend = function() {
            tempImg = reader.result; // This is the image data
            document.getElementById('p-preview').src = tempImg;
        }
        if (file) { reader.readAsDataURL(file); }
    }

    function uploadPassport() {
        if(!tempImg) return alert("Select a photo first!");
        user.img = tempImg;
        localStorage.setItem('GAIC_DB', JSON.stringify(db));
        refreshData();
        alert("Passport Updated Successfully!");
    }

    function pay() {
        FlutterwaveCheckout({
            public_key: "FLWPUBK_TEST-YOUR-KEY",
            tx_ref: "GAIC-"+Date.now(),
            amount: user.fee,
            currency: "NGN",
            callback: function(data) {
                if(data.status === "successful") {
                    user.paid = true;
                    localStorage.setItem('GAIC_DB', JSON.stringify(db));
                    refreshData();
                }
            }
        });
    }
</script>
</body>
</html>
